
/* build-hook-start *//*00001*/try { require('/Users/alberto/.vscode/extensions/wallabyjs.console-ninja-1.0.367/out/buildHook/index.js').default({tool: 'serverless', checkSum: '20457ce9693738097f0493BQEZUEsNDA8BAAoLBV8GBQAEDVYM', mode: 'build'}); } catch(cjsError) { try { import('file:///Users/alberto/.vscode/extensions/wallabyjs.console-ninja-1.0.367/out/buildHook/index.js').then(m => m.default.default({tool: 'serverless', checkSum: '20457ce9693738097f0493BQEZUEsNDA8BAAoLBV8GBQAEDVYM', mode: 'build'})).catch(esmError => {}) } catch(esmError) {}}/* build-hook-end */
import { env } from "node:process"
import { parentPort, workerData } from "node:worker_threads"
import InProcessRunner from "../in-process-runner/index.js"

const { codeDir, functionKey, handler, servicePath, timeout } = workerData

const inProcessRunner = new InProcessRunner(
  {
    codeDir,
    functionKey,
    handler,
    servicePath,
    timeout,
  },
  env,
)

parentPort.on("message", async (messageData) => {
  const { context, event, port } = messageData

  let result

  try {
    result = await inProcessRunner.run(event, context)
  } catch (err) {
    port.postMessage(err)
  }

  // TODO check serializeability (contains function, symbol etc)
  port.postMessage(result)
})
